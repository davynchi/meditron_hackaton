# Документация по решению

## Общая структура

- `src/main.py` — загрузка данных из каталога `data/`, нормализация колонок, запуск Dash‑приложения.
- `src/dashboard.py` — построение интерфейса, карточек анализов, индикаторов и исторических графиков.
- `src/login.py` — простая форма входа и callbacks переключения экранов.
- `tests/` — модульные тесты для критичных вспомогательных функций.
- `config/` — пример конфигурации окружения и путей.

## Обработка медицинских данных

1. **Чтение файлов.** Функция `read_tabular_file` автоматически определяет разделитель (`;` для `анализ_крови`, `,` для остальных) и нормализует названия столбцов (`Gender → Пол`, `Age → Возраст`, `Date → Дата`). Это позволяет безопасно объединять разнородные выгрузки в одну таблицу.
2. **Фильтрация по ID.** `build_patient_options` собирает уникальные `ID` пациентов. При выборе ID в интерфейсе отображаются все строки из всех таблиц, связанные с этим пациентом.
3. **Карточки показателей.** `build_patient_result_sections` для каждого источника генерирует `<details>` с:
   - заголовком (`Источник`, имя и пол пациента),
   - списком кликабельных карточек по каждому измерению (кроме служебных столбцов),
   - дополнительными индикаторами для гемоглобина и тромбоцитов.
4. **Индикаторы норм.** `build_range_gauge` визуализирует значение в градиентной строке. Центральная часть — диапазон нормы; крайние сегменты сигнализируют о дефиците/избытке. При клике открывается исторический график (`_build_metric_history`) с красными линиями по колонкам `мин/макс норма`.
5. **Цветовые статусы диагноза.** Для `анализ_мочи.*` карточка `Диагноз` подсвечивается зелёным при значении `NEGATIVE` и красным для `POSITIVE`.

## Интерфейс

- **Блок выбора пациента.** Выпадающий список ID + кнопка выхода.
- **Секция пациента.** Для каждого источника:
  - Заголовок: «Источник: …» + строка «Имя — Пол».
  - Список `<details>`: дата анализа, индикаторы, карточки показателей.
  - Графики (появляются при клике) с историей конкретного показателя.
- **Глобальные графики.** Box‑plot по выбранному показателю и scatter (Эритроциты vs. Гемоглобин).

## Ключевые алгоритмы

| Функция | Описание |
| --- | --- |
| `load_all_datasets` | Загружает все CSV/XLSX из каталога, нормализует названия столбцов, добавляет `Source_File`. |
| `build_patient_result_sections` | Группирует строки по источнику, создаёт карточки, индикаторы, графики. Учитывает клинико‑значимые поля (`Имя`, `Пол`, `Диагноз`). |
| `build_range_gauge` | Нормализует значение показателя, отображает его на градиентной полосе и добавляет визуальные границы нормы. |
| `_build_metric_history` | Строит исторический график по датам и добавляет красные линии по границам нормы. |

## Конфигурация

- `config/settings.example.yaml` — пример файла с путями до каталога данных и параметрами порта.

## Тесты

Запуск:

```bash
python -m pytest
```

Покрывают функции проекта.
